# 实验二：数值微分的误差权衡

## 实验背景

数值微分是计算物理中的基础技术，但在实际计算中会面临截断误差与舍入误差的双重挑战。导数的定义为：

$$
{d f\over d x} = \lim_{\delta\to0} {f(x+\delta)-f(x)\over\delta}.
$$

在计算机中，我们无法实现 $\delta\to 0$，只能使 $\delta$ 足够小。然而，当 $\delta$ 过小时，舍入误差会显著影响计算结果。

## 实验目标

1. 理解数值微分中截断误差与舍入误差的权衡关系
2. 观察有限差分法计算导数时的误差变化规律
3. 分析步长对数值微分精度的影响
4. 确定最优步长范围

## 实验任务

### 任务一：前向差分法计算导数

1. 实现函数 `f(x)` 返回 `x(x-1)`
2. 使用前向差分公式计算函数在 x=1 点的导数：
   ```python
   def forward_diff(f, x, delta):
       return (f(x + delta) - f(x)) / delta
   ```

3. 分别取 $\delta = 10^{-2}, 10^{-4}, 10^{-6}, 10^{-8}, 10^{-10}, 10^{-12}, 10^{-14}$
4. 计算每个步长下的数值导数值，与解析解 (f'(1) = 1) 比较
5. 计算相对误差并绘制误差-步长关系图（对数坐标）
### 任务二：中心差分法计算导数
1. 实现中心差分公式计算导数：
   ```python
   def central_diff(f, x, delta):
       return (f(x + delta) - f(x - delta)) / (2 * delta)
    ```
2. 使用与任务一相同的步长序列
3. 计算每个步长下的数值导数值，与解析解比较
4. 计算相对误差并绘制误差-步长关系图（对数坐标）
### 任务三：比较与分析
1. 在同一图表中比较前向差分和中心差分的误差曲线
3. 分析两种方法的收敛阶数（斜率）
4. 解释为什么误差随步长减小先减小后增大
5. 确定两种方法的最优步长范围
   最优步长分析:
前向差分最优步长: 1.00e-08, 相对误差: 3.922529e-09
中心差分最优步长: 1.00e-02, 相对误差: 8.881784e-16
## 提交要求
1. 完成 differentiation.py 文件中的函数实现
2. 提交实验报告，包含：
   - 实验方法说明
     A:实现了测试函数 f(x)=x(x−1)。实现了前向差分和中心差分方法，用于计算数值导数。实现了解析导数 f′(x)=2x−1。 
       生成步长序列 δ=10^−2,10^−4,10^−6,10^−8,10^−10,10^−12,10^−14。计算了每个步长下的前向差分和中心差分的相对误差。
       绘制了误差-步长关系图
   - 数据表格（不同步长下的导数值和相对误差）
     A:![fc22eca85dbb4d50d00043dcd63af31](https://github.com/user-attachments/assets/45e0068e-e42a-487a-9fb8-8c5100e9b13f)

   - 误差-步长关系图（对数坐标）
     A:![image](https://github.com/user-attachments/assets/bff65f29-4eef-49e2-82c7-f627a014601b)

   - 分析与讨论（误差来源、最优步长、方法比较）
     A:误差来源：截断误差：由于使用有限差分近似导数定义引入的误差，通常随步长减小而减小。
                舍入误差：由于计算机浮点数表示的有限精度引入的误差，通常随步长减小而增大。
       在实验中观察到，当步长较小时，舍入误差显著增大，而当步长较大时，截断误差显著增大。
      前向差分与中心差分的比较：精度差异：中心差分方法的精度通常高于前向差分方法，因为中心差分方法的截断误差阶数更高。
      原因：中心差分方法使用对称的点对，能够更好地抵消高阶项的误差。
        A: 最优步长分析:前向差分最优步长: 1.00e-08, 相对误差: 3.922529e-09。中心差分最优步长: 1.00e-02, 相对误差: 8.881784e-16。
        收敛阶数分析:前向差分收敛阶数约为: 1.20。中心差分收敛阶数约为: -0.65。
        A:方法比较：中心差分方法通常具有更高的精度，但对步长的选择更为敏感。前向差分方法虽然精度较低，但在某些情况下可能更稳定。                    
   - 结论
     A:误差分析：数值微分中存在截断误差和舍入误差的权衡，最优步长出现在两者达到平衡的点。
       最优步长范围：前向差分：1.00e-08。中心差分：1.00e-02。
       方法比较：中心差分方法通常具有更高的精度，但对步长的选择更为敏感。前向差分方法虽然精度较低，但在某些情况下可能更稳定。        
      
